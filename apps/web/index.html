<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AR.js (HIRO) + Chat</title>

  <!-- A-Frame & AR.js -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <!-- ì±„íŒ… ê³µìš© ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="./styles/chat.css" />

  <style>
    html, body { height: 100%; margin: 0; background:#000; }
    a-scene    { position: fixed; inset: 0; width: 100vw; height: 100vh; }
    canvas, .a-canvas { width: 100% !important; height: 100% !important; display: block; }

    /* ì˜¤ë²„ë ˆì´ê°€ AR ìœ„ì— ë³´ì´ë„ë¡ */
    #startAR, #log, #chatbar { position: fixed; z-index: 9999; }
    #startAR{
      left: 16px; right: 16px; bottom: 92px;
      padding: 14px 16px; border: 0; border-radius: 12px;
      background: #1e90ff; color: #fff; font-size: 16px;
    }

    /* ìµœì†Œ ì˜¤ë²„ë ˆì´ (chat.cssê°€ ìˆë‹¤ë©´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì•½í•˜ê²Œ ì§€ì •) */
    #log{
      left: 12px; right: 12px; bottom: 148px;
      max-height: 40vh; overflow:auto; color:#fff; font:14px/1.4 system-ui;
      pointer-events: none; /* ìŠ¤í¬ë¡¤ í•„ìš”í•˜ë©´ ì œê±° */
    }
    #chatbar{
      left: 0; right: 0; bottom: 0;
      display: flex; gap: 8px; align-items: center;
      padding: 10px 12px; background: rgba(0,0,0,.55); backdrop-filter: blur(4px);
    }
    #chatbar input{
      flex:1; height:40px; border-radius:10px; border:1px solid #555; background:#111; color:#fff; padding:0 10px;
    }
    #chatbar button{
      height:40px; border-radius:10px; border:0; padding:0 12px; background:#2d7eff; color:#fff;
    }
  </style>
</head>
<body>

  <!-- AR.js: HIRO ë§ˆì»¤ ì¶”ì  -->
  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="precision: mediump; antialias: false"
    arjs="
      sourceType: webcam;
      facingMode: environment;
      detectionMode: mono;
      debugUIEnabled: false;
      sourceWidth: 640;  sourceHeight: 480;
      displayWidth: 640; displayHeight: 480;
      videoTexture: true;
    "
  >
    <!-- HIRO ë§ˆì»¤ ìœ„ì— ë°•ìŠ¤ í‘œì‹œ -->
    <a-marker preset="hiro">
      <a-box position="0 0.5 0" depth="0.5" height="0.5" width="0.5" color="#4CC3D9"
             animation="property: rotation; to: 0 405 0; loop: true; dur: 3000"></a-box>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <!-- (ì¼ë¶€ ê¸°ê¸°ìš©) ì‚¬ìš©ì ì œìŠ¤ì²˜ë¡œ ì‹œì‘ -->
  <button id="startAR">AR ì‹œì‘</button>

  <!-- ì±„íŒ… ì˜¤ë²„ë ˆì´ -->
  <div id="log" aria-live="polite"></div>
  <div id="chatbar">
    <button id="mic" title="ìŒì„± ì…ë ¥">ğŸ¤</button>
    <input id="msg" placeholder="AR ì±—ë´‡ì—ê²Œ ë§ ê±¸ê¸°..." />
    <button id="send">ë³´ë‚´ê¸°</button>
  </div>

  <!-- ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ (ì‚¬ìš©ì ì œìŠ¤ì²˜ í›„ ì¹´ë©”ë¼ ì‹œì‘) -->
  <script>
    const scene = document.querySelector('a-scene');
    const btn   = document.getElementById('startAR');
    const start = () => {
      const go = () => {
        try { scene.components?.arjs?.start?.(); } catch(e) { /* ìë™ì‹œì‘ì´ë©´ ë¬´ì‹œ */ }
        btn.style.display = 'none';
      };
      scene.hasLoaded ? go() : scene.addEventListener('loaded', go, { once:true });
    };
    btn.addEventListener('click', start, { once:true });
  </script>

  <!-- ì±—ë´‡ ë¡œì§ -->
  <script src="./scripts/chat.js" type="module"></script>
</body>
</html>
